<html>
    <head>
        <title>Code Wheel</title>
        <script src='Winwheel.js'></script>
        <link rel="stylesheet" type="text/css" href="style.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
    </head>
    <body>
        <div class="container-image">
            <img class="logo-image" src="https://drive.google.com/thumbnail?id=1PENrpGnBFuupSg_npwz2cIh1A28teWv4" />
        </div>
        <div id="container-alert"></div>
        <div class="container-row">
            <div class="content-roullete col">
                <div class="form-row text-center">
                    <div class="kodex-point"></div>
                </div>
                <canvas id='canvas' width='440' height='440'>
                    Canvas not supported, use another browser.
                </canvas>
            </div>
            <div class="content-form col">
                <h5 class="title">Jogue para ganhar!</h5>
                <p class="subtitle">
                    Ei você que não ganha nem bingo! Aqui tem vale compras de até 10%. É só girar a roleta! Teste sua sorte.
                </p>
                <form>
                    <div class="mb-3">
                        <input type="text" placeholder="Digite seu nome" class="form-control" id="nameInput" aria-describedby="nameHelp">
                    </div>
                    <div class="mb-3">
                      <input type="email" placeholder="Digite seu e-mail" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp">
                    </div>
                    <div class="mb-3">
                        <input type="tel" placeholder="Digite seu telefone" class="form-control" id="(12)99232-0029" aria-describedby="cellphoneHelp">
                    </div>
                </form>
                <div class="d-grid gap-2">
                    <button id="popoverButton" type="button" onclick="startRoullete();" class="btn btn-primary" data-bs-toggle="popover" title="ESM in Browser" data-bs-content="Bang!">Girar</button>
                </div>
            </div>
        </div>
        
        <footer class="container-footer">
            <a href="https://www.kodex.dev.br/" target="_blank">
                <img class="kodex-logo"  src="https://drive.google.com/thumbnail?id=1PENrpGnBFuupSg_npwz2cIh1A28teWv4" />
            </a>
        </footer>
        <script>
            let theWheel = new Winwheel({
                'numSegments'  : 8,         // Number of segments
                'outerRadius'  : 212,       // The size of the wheel.
                'textFontSize' : 18,        // Font size.
                'lineWidth'   : 2,
                'segments'     :            // Definition of all the segments.
                [
                   {'fillStyle' : '#FFF', 'text' : 'Frete grátis',},
                   {'fillStyle' : '#000', 'text' : '1% Desconto', 'textFillStyle': '#FFF'},
                   {'fillStyle' : '#FFF', 'text' : 'Tente outra vez!'},
                   {'fillStyle' : '#000', 'text' : '10% Desconto', 'textFillStyle': '#FFF'},
                   {'fillStyle' : '#FFF', 'text' : '2% Desconto'},
                   {'fillStyle' : '#000', 'text' : 'Frete grátis', 'textFillStyle': '#FFF'},
                   {'fillStyle' : '#FFF', 'text' : '5% Desconto'},
                   {'fillStyle' : '#000', 'text' : 'Tente outra vez!', 'textFillStyle': '#FFF'}
                ],
                'animation' :               // Definition of the animation
                {
                    'type'     : 'spinToStop',
                    'duration' : 8,
                    'spins'    : 8,
                    'callbackFinished' : alertPrize,
                    'callbackSound' : playSound,	// Specify function to call when sound is to be triggered.
                },
            });

            let audio = new Audio('tick.mp3');  // Create audio object and load desired file.
            let success = new Audio('success-song.mp3');  // Create audio object and load desired file.

            function startRoullete() {
                theWheel.startAnimation()
            }

            function playSound(){
                // Stop and rewind the sound (stops it if already playing).
                audio.pause();
                audio.currentTime = 0;

                // Play the sound.
                audio.play();
            }

            function handleBuildMessage(type, award) {
                if (type === 'success') {
                    return `Parabéns você acaba de ganhar "${award}", um enviamos com cupom com o seu prêmio
                    para o seu e-mail, não perca esta oportunidade :)`
                }

                else {
                    return `Ficamos triste por você, o resultado da roleta foi "${award}", mas não se preocupe com isso, você
                    terá novas chances :)`
                }
            }

            function handleCreateAlert(message, award, type) {
                const wrapper = document.getElementById('container-alert')
                wrapper.innerHTML = [
                    `<div class="alert alert-${type === 'success' ? 'success' : 'warning'} alert-dismissible" role="alert">`,
                    `   <h4 class="alert-heading">${type === 'success' ? 'Você ganhou!' : 'Não foi desta vez!'}</h4>`,
                    `   <p>${message}</p>`,
                    '</div>'
                ].join('')
            }
 
            // Called when the animation has finished.
            function alertPrize(indicatedSegment)
            {
                // Do basic alert of the segment text.
                success.play();
                startConfetti()
                const message = handleBuildMessage('losted', indicatedSegment.text)
                handleCreateAlert(message, indicatedSegment.text, 'losted')
                // alert("You have won " + indicatedSegment.text);
            }

            function startConfetti() {
                const end = Date.now() + 15 * 1000;

                const colors = ["#bb0000", "#ffffff"];

                (function frame() {
                confetti({
                    particleCount: 2,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: colors,
                });

                confetti({
                    particleCount: 2,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: colors,
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
                })();
            }
        </script>
    </body>
</html>